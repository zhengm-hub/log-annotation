<?xml version="1.0" encoding="UTF-8"?>
<project name="checkstyle" default="checkstyle" basedir="."> <!-- 检查源码的路径 -->
    <target name="init">
        <tstamp/>
        <!-- 输出报告的路径  -->
        <property name="project.dir" value="${JENKINS_WORKSPACE}\${JOB_NAME}"/>
        <property name="project.checkstyle.report.dir" value="${project.dir}\checkstyle_report\${BUILD_NUMBER}"/>
        <property name="project.checkstyle.result.name" value="checkstyle-result.xml"/>
        <property name="project.checkstyle.report.name" value="checkstyle-report.html"/>
        <!-- 检测规则存放路径  -->
        <property name="checkstyle.config" value="${CHECKSTYLE_INSTALL}\sun_checks.xml"/>
        <property name="checkstyle.report.style" value="${CHECKSTYLE_INSTALL}\contrib\checkstyle-author.xsl"/>
        <property name="checkstyle.result" value="${project.checkstyle.report.dir}\${project.checkstyle.result.name}"/>
        <property name="checkstyle.report" value="${project.checkstyle.report.dir}\${project.checkstyle.report.name}"/>
        <mkdir dir="${project.checkstyle.report.dir}"/>
    </target>


    <taskdef resource="checkstyletask.properties" classpath="${CHECKSTYLE_INSTALL}\checkstyle-5.7-all.jar" />
    <target name="checkstyle"  depends="init" description="check java code and report." >
         <checkstyle config="${checkstyle.config}" failureProperty="checkstyle.failure"  failOnViolation="false">
            <formatter type="xml"   tofile="${checkstyle.result}" />
            <fileset dir="${project.dir}" includes="**/*.java" /> <!-- 检查源代码的存放路径 -->
        </checkstyle>
        <!-- 通过指定的xsl模版文件生成一份html的报告，这里生成的文件用于邮件发送时附加上，另外Jenkins插件也会生成可视化的结果  -->
        <style in="${checkstyle.result}" out="${checkstyle.report}" style="${checkstyle.report.style}" />
    </target>
</project>
